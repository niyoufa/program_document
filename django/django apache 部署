
django apache 部署

1. 安装 apache2 和 mod_wsgi

sudo apt-get install apache2
 
# Python 2
sudo apt-get install libapache2-mod-wsgi
http://blog.chinaunix.net/uid-20940095-id-4408225.html?hmsr=toutiao.io&utm_medium=toutiao.io&utm_source=toutiao.io
 
# Python 3
sudo apt-get install libapache2-mod-wsgi-py3

2. 确认安装的apache2版本号

apachectl -v

3. 新建一个网站配置文件

sudo vi /etc/apache2/sites-available/sitename.conf
内容如下：
<VirtualHost *:80>
    ServerName 127.0.0.1
    ServerAlias 127.0.0.1
    ServerAdmin 1061794187@qq.com

    #Alias /media/ /home/dhui100/develop/djangoproject/djangoauth/djangoauth/media/
    Alias /static/ /home/dhui100/develop/djangoproject/djangoauth/static/

    <Directory /home/dhui100/develop/djangoproject/djangoauth/djangoauth/media/>
        Require all granted
    </Directory>

    <Directory /home/dhui100/develop/djangoproject/djangoauth/static/>
        Require all granted
    </Directory>

    WSGIScriptAlias / /home/dhui100/develop/djangoproject/djangoauth/djangoauth/wsgi.py
    # WSGIDaemonProcess youfa.com python-path=/home/dhui123/develop/djangoproject/djangoauth:/home/dhui123/.virtualenvs/develop/djangoproject/djangoauth/lib/python2.7/site-packages
    # WSGIProcessGroup youfa.com

    <Directory /home/dhui100/develop/djangoproject/djangoauth/djangoauth/>
    <Files wsgi.py>
        Require all granted
    </Files>
    </Directory>
</VirtualHost>

4. 修改wsgi.py文件

加入如下内容：
from os.path import join,dirname,abspath
 
PROJECT_DIR = dirname(dirname(abspath(__file__)))#3
import sys # 4
sys.path.insert(0,PROJECT_DIR) # 5

5. 设置目录和文件权限

一般目录权限设置为 755，文件权限设置为 644 

假如项目位置在 /home/tu/zqxt （在zqxt 下面有一个 manage.py，zqxt 是项目名称）
cd /home/tu/
sudo chmod -R 644 zqxt
sudo find zqxt -type d -exec chmod 755 \{\} \;

6. 集成静态文件,settings.py 设置

python manage.py collectstatic
在settings.py中设置：

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/dev/howto/static-files/
STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR,'static')
 
# upload folder
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR,'media')

7. 激活新网站

sudo a2ensite sitename 或 sudo a2ensite sitename.conf

8. 错误排查

cat /var/log/apache2/error.log

9. 总结

部署时文件对应关系:

sitename.conf --> wsgi.py --> settings.py --> urls.py --> views.py




 
